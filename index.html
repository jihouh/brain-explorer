<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Explorer Academy</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --focus-blue: #4ECDC4;
            --memory-green: #95E1D3;
            --challenge-orange: #F38181;
            --plan-purple: #AA96DA;
            --gold: #FFD93D;
            --dark: #2C3E50;
            --light: #F7F9FC;
            --parent-teal: #2A9D8F;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .game-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .game-header h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 3em;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .screen {
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: var(--dark);
            margin-bottom: 15px;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--focus-blue), #3dbdb4);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.6);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, var(--plan-purple), #8b7bc7);
            box-shadow: 0 4px 15px rgba(170, 150, 218, 0.4);
        }
        
        .btn-orange {
            background: linear-gradient(135deg, var(--challenge-orange), #e85a5a);
            box-shadow: 0 4px 15px rgba(243, 129, 129, 0.4);
        }
        
        .btn-green {
            background: linear-gradient(135deg, var(--memory-green), #7bc4b5);
            box-shadow: 0 4px 15px rgba(149, 225, 211, 0.4);
            color: var(--dark);
        }
        
        .btn-parent {
            background: linear-gradient(135deg, var(--parent-teal), #21867a);
            box-shadow: 0 4px 15px rgba(42, 157, 143, 0.4);
        }
        
        .nav-bar {
            background: white;
            padding: 15px;
            border-radius: 50px;
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .avatar-option {
            font-size: 3em;
            padding: 20px;
            border: 4px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light);
            text-align: center;
        }
        
        .avatar-option:hover {
            transform: scale(1.1);
            border-color: var(--gold);
        }
        
        .avatar-option.selected {
            border-color: var(--gold);
            background: #fff9e6;
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
        }
        
        .name-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #ddd;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Nunito', sans-serif;
            text-align: center;
        }
        
        .name-input:focus {
            outline: none;
            border-color: var(--focus-blue);
        }
        
        .explorer-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .explorer-avatar {
            font-size: 4em;
            background: white;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .explorer-info h2 {
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .level-badge {
            background: var(--gold);
            color: var(--dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat {
            background: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9em;
        }
        
        .stat-bar {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .stat-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .fill-focus { background: var(--focus-blue); }
        .fill-memory { background: var(--memory-green); }
        .fill-challenge { background: var(--challenge-orange); }
        .fill-plan { background: var(--plan-purple); }
        
        .islands-map {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .island {
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .island:hover {
            transform: translateY(-5px) scale(1.02);
        }
        
        .island-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .island h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .island-progress {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .island-progress-bar {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.5s;
        }
        
        .focus-island { background: linear-gradient(135deg, var(--focus-blue), #3dbdb4); color: white; }
        .memory-island { background: linear-gradient(135deg, var(--memory-green), #7bc4b5); color: var(--dark); }
        .challenge-island { background: linear-gradient(135deg, var(--challenge-orange), #e85a5a); color: white; }
        .plan-island { background: linear-gradient(135deg, var(--plan-purple), #8b7bc7); color: white; }
        
        .mission-container {
            text-align: center;
        }
        
        .mission-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border-left: 8px solid;
        }
        
        .mission-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8em;
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .mission-desc {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
        }
        
        .mission-task {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .timer {
            font-size: 2em;
            font-family: 'Fredoka One', cursive;
            color: var(--challenge-orange);
            margin: 20px 0;
        }
        
        .game-area {
            min-height: 200px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--focus-blue), #3dbdb4);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 80px;
        }
        
        .memory-card:hover {
            transform: scale(1.05);
        }
        
        .memory-card.flipped {
            background: white;
            border: 3px solid var(--focus-blue);
        }
        
        .memory-card.matched {
            background: var(--memory-green);
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .spotlight-area {
            position: relative;
            height: 300px;
            background: #2C3E50;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .distraction {
            position: absolute;
            font-size: 1.5em;
            opacity: 0.7;
            animation: float-around 4s infinite linear;
        }
        
        @keyframes float-around {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(50px, -30px) rotate(90deg); }
            50% { transform: translate(0, -60px) rotate(180deg); }
            75% { transform: translate(-50px, -30px) rotate(270deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }
        
        .task-list {
            list-style: none;
            text-align: left;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .task-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid var(--plan-purple);
            cursor: move;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .task-number {
            background: var(--plan-purple);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .reflection {
            background: #fff9e6;
            border: 3px solid var(--gold);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .reflection h3 {
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .reflection-options {
            display: grid;
            gap: 10px;
        }
        
        .reflection-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
        }
        
        .reflection-btn:hover {
            border-color: var(--gold);
            background: #fffef5;
        }
        
        .crystal {
            display: inline-block;
            font-size: 2em;
            animation: sparkle 2s infinite;
            margin: 0 5px;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
        }
        
        .reward-screen {
            text-align: center;
            padding: 20px;
        }
        
        .reward-screen h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5em;
            color: var(--gold);
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .badges-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .badge {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 4px solid #ddd;
            opacity: 0.5;
            transition: all 0.5s;
        }
        
        .badge.earned {
            opacity: 1;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
            animation: badgePop 0.6s ease;
        }
        
        @keyframes badgePop {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        
        /* Parent Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5em;
            color: var(--dark);
            margin: 10px 0;
        }
        
        .skill-bar {
            margin: 15px 0;
        }
        
        .skill-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .progress-bg {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .fill-focus { background: linear-gradient(90deg, var(--focus-blue), #3dbdb4); }
        .fill-memory { background: linear-gradient(90deg, var(--memory-green), #7bc4b5); color: var(--dark); }
        .fill-challenge { background: linear-gradient(90deg, var(--challenge-orange), #e85a5a); }
        .fill-plan { background: linear-gradient(90deg, var(--plan-purple), #8b7bc7); }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--focus-blue), var(--plan-purple));
            border-radius: 3px;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            border: 3px solid;
        }
        
        .timeline-focus { border-left-color: var(--focus-blue); }
        .timeline-focus::before { border-color: var(--focus-blue); }
        .timeline-memory { border-left-color: var(--memory-green); }
        .timeline-memory::before { border-color: var(--memory-green); }
        .timeline-challenge { border-left-color: var(--challenge-orange); }
        .timeline-challenge::before { border-color: var(--challenge-orange); }
        .timeline-plan { border-left-color: var(--plan-purple); }
        .timeline-plan::before { border-color: var(--plan-purple); }
        
        .timeline-date {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 5px;
        }
        
        .timeline-title {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .tip-card {
            background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%);
            border: 2px solid var(--gold);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
        }
        
        .tip-card::before {
            content: 'üí°';
            position: absolute;
            top: -15px;
            left: 20px;
            background: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 1.2em;
            border: 2px solid var(--gold);
        }
        
        .tip-card h4 {
            color: var(--dark);
            margin-bottom: 10px;
            margin-top: 10px;
            font-family: 'Fredoka One', cursive;
        }
        
        .tip-action {
            background: white;
            padding: 10px 15px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 4px solid var(--gold);
            font-style: italic;
        }
        
        .insight-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196F3;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .comparison-chart {
            display: flex;
            height: 200px;
            align-items: flex-end;
            justify-content: space-around;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .chart-bar {
            width: 50px;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s;
            position: relative;
        }
        
        .chart-bar::after {
            content: attr(data-value);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: var(--dark);
        }
        
        .chart-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle.active {
            background: var(--parent-teal);
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .toggle.active .toggle-slider {
            transform: translateX(30px);
        }
        
        .parent-gate {
            text-align: center;
            padding: 40px;
        }
        
        .pin-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .pin-digit {
            width: 50px;
            height: 60px;
            font-size: 1.5em;
            text-align: center;
            border: 3px solid #ddd;
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
        }
        
        .pin-digit:focus {
            outline: none;
            border-color: var(--parent-teal);
        }
        
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none !important; }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--gold);
            animation: confetti-fall 3s linear forwards;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        @media (max-width: 768px) {
            .game-header h1 { font-size: 2em; }
            .islands-map { grid-template-columns: 1fr; }
            .avatar-selection { grid-template-columns: repeat(2, 1fr); }
            .memory-grid { grid-template-columns: repeat(3, 1fr); }
            .explorer-card { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1>üß† Brain Explorer Academy</h1>
            <p class="subtitle">Learn How to Learn ‚Ä¢ Ages 5-7</p>
        </div>

        <div class="nav-bar" id="main-nav">
            <button class="btn" onclick="showScreen('screen-create')">üéÆ Play Game</button>
            <button class="btn btn-parent" onclick="showParentGate()">üë®‚Äçüë©‚Äçüëß Parent Dashboard</button>
            <button class="btn btn-purple" onclick="showScreen('screen-about')">‚ÑπÔ∏è About</button>
        </div>

        <!-- About Screen -->
        <div id="screen-about" class="screen active">
            <div class="card">
                <h2>üåü Welcome to Brain Explorer Academy!</h2>
                <p style="font-size: 1.1em; line-height: 1.8; color: #555; margin-bottom: 20px;">
                    This free game teaches children <strong>how to learn</strong> through four exciting islands:
                </p>
                <ul style="font-size: 1.1em; line-height: 2; color: #555; margin-left: 20px; margin-bottom: 20px;">
                    <li><strong>üî¶ Focus Falls</strong> - Attention and concentration skills</li>
                    <li><strong>üå± Memory Meadows</strong> - Remembering strategies</li>
                    <li><strong>üßó Challenge Canyon</strong> - Growth mindset and resilience</li>
                    <li><strong>üó∫Ô∏è Plan Peak</strong> - Organization and planning</li>
                </ul>
                <div class="text-center mt-20">
                    <button class="btn" style="font-size: 1.2em; padding: 15px 40px;" onclick="showScreen('screen-create')">
                        Start Your Adventure! üöÄ
                    </button>
                </div>
                <p class="text-center mt-20" style="color: #888; font-size: 0.9em;">
                    üíæ Your progress saves automatically in this browser.<br>
                    üë®‚Äçüë©‚Äçüëß Parents: Click "Parent Dashboard" to track learning progress.
                </p>
            </div>
        </div>

        <!-- Character Creation -->
        <div id="screen-create" class="screen">
            <div class="card">
                <h2 class="text-center">Create Your Explorer</h2>
                
                <div class="avatar-selection">
                    <div class="avatar-option selected" data-avatar="ü¶Å">ü¶Å</div>
                    <div class="avatar-option" data-avatar="üöÄ">üöÄ</div>
                    <div class="avatar-option" data-avatar="üåü">üåü</div>
                    <div class="avatar-option" data-avatar="ü¶∏">ü¶∏</div>
                    <div class="avatar-option" data-avatar="ü¶Ñ">ü¶Ñ</div>
                    <div class="avatar-option" data-avatar="ü§ñ">ü§ñ</div>
                    <div class="avatar-option" data-avatar="üåà">üåà</div>
                    <div class="avatar-option" data-avatar="‚ö°">‚ö°</div>
                </div>
                
                <input type="text" id="explorer-name" class="name-input" placeholder="Enter your explorer name..." maxlength="20">
                
                <div class="text-center">
                    <button class="btn" onclick="createExplorer()">Start Adventure! üöÄ</button>
                </div>
            </div>
        </div>

        <!-- Kids Dashboard -->
        <div id="screen-dashboard" class="screen">
            <div class="explorer-card">
                <div class="explorer-avatar" id="dash-avatar">ü¶Å</div>
                <div class="explorer-info">
                    <h2 id="dash-name">Explorer</h2>
                    <span class="level-badge" id="dash-level">Level 1 Trainee</span>
                    <div class="stats">
                        <div class="stat">
                            ‚ö° Focus: <span id="stat-focus">0</span>/10
                            <div class="stat-bar"><div class="stat-fill fill-focus" id="bar-focus" style="width: 0%"></div></div>
                        </div>
                        <div class="stat">
                            üå± Memory: <span id="stat-memory">0</span>/10
                            <div class="stat-bar"><div class="stat-fill fill-memory" id="bar-memory" style="width: 0%"></div></div>
                        </div>
                        <div class="stat">
                            üí™ Challenge: <span id="stat-challenge">0</span>/10
                            <div class="stat-bar"><div class="stat-fill fill-challenge" id="bar-challenge" style="width: 0%"></div></div>
                        </div>
                        <div class="stat">
                            üó∫Ô∏è Plan: <span id="stat-plan">0</span>/10
                            <div class="stat-bar"><div class="stat-fill fill-plan" id="bar-plan" style="width: 0%"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h3 style="text-align: center; color: var(--dark); margin-bottom: 15px;">Choose Your Training Island:</h3>
            
            <div class="islands-map">
                <div class="island focus-island" onclick="startMission('focus')">
                    <div class="island-icon">üî¶</div>
                    <h3>Focus Falls</h3>
                    <p>Train your attention power!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-focus" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-focus">0</span>/3 Missions</p>
                </div>
                
                <div class="island memory-island" onclick="startMission('memory')">
                    <div class="island-icon">üå±</div>
                    <h3>Memory Meadows</h3>
                    <p>Grow your memory garden!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-memory" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-memory">0</span>/3 Missions</p>
                </div>
                
                <div class="island challenge-island" onclick="startMission('challenge')">
                    <div class="island-icon">üßó</div>
                    <h3>Challenge Canyon</h3>
                    <p>Climb the learning pit!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-challenge" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-challenge">0</span>/3 Missions</p>
                </div>
                
                <div class="island plan-island" onclick="startMission('plan')">
                    <div class="island-icon">üó∫Ô∏è</div>
                    <h3>Plan Peak</h3>
                    <p>Map your adventures!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-plan" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-plan">0</span>/3 Missions</p>
                </div>
            </div>
            
            <div class="text-center mt-20">
                <div id="total-crystals" style="font-size: 1.2em; margin-bottom: 15px;">
                    Total Power Crystals: <span class="crystal">üíé</span> <span id="crystal-count">0</span>
                </div>
                <button class="btn btn-purple" onclick="viewBadges()">View My Badges üèÜ</button>
                <button class="btn btn-orange" onclick="resetGame()">New Explorer üîÑ</button>
            </div>
        </div>

        <!-- Mission Screen -->
        <div id="screen-mission" class="screen">
            <div class="mission-container">
                <div id="mission-content"></div>
            </div>
        </div>

        <!-- Reward Screen -->
        <div id="screen-reward" class="screen">
            <div class="card reward-screen">
                <h2>Mission Complete! üéâ</h2>
                <div id="reward-message"></div>
                <div class="badges-container" id="badges-display">
                    <div class="badge" id="badge-focus" title="Focus Master">üî¶</div>
                    <div class="badge" id="badge-memory" title="Memory Gardener">üå±</div>
                    <div class="badge" id="badge-challenge" title="Puzzle Solver">üßó</div>
                    <div class="badge" id="badge-plan" title="Map Maker">üó∫Ô∏è</div>
                    <div class="badge" id="badge-master" title="Brain Master">üß†</div>
                </div>
                <div id="crystals-earned" class="mt-20" style="font-size: 1.5em;"></div>
                <button class="btn mt-20" onclick="returnToDashboard()">Back to Academy üè†</button>
            </div>
        </div>

        <!-- Badges Screen -->
        <div id="screen-badges" class="screen">
            <div class="card">
                <h2 class="text-center">Your Badge Collection</h2>
                <div class="badges-container" id="full-badge-collection" style="flex-direction: column; align-items: center;"></div>
                <div class="text-center mt-20">
                    <button class="btn" onclick="returnToDashboard()">Back to Academy üè†</button>
                </div>
            </div>
        </div>

        <!-- Parent Gate -->
        <div id="screen-parent-gate" class="screen">
            <div class="card parent-gate">
                <h2>üîí Parent Area</h2>
                <p>Enter the magic number to access progress tracking:</p>
                <div class="pin-input">
                    <input type="password" class="pin-digit" maxlength="1" id="pin1" onkeyup="movePin(1)">
                    <input type="password" class="pin-digit" maxlength="1" id="pin2" onkeyup="movePin(2)">
                    <input type="password" class="pin-digit" maxlength="1" id="pin3" onkeyup="movePin(3)">
                    <input type="password" class="pin-digit" maxlength="1" id="pin4" onkeyup="checkPin()">
                </div>
                <p style="color: #888; font-size: 0.9em;">Default: 1234</p>
                <button class="btn btn-parent mt-20" onclick="checkPin()">Unlock üîì</button>
                <button class="btn mt-20" onclick="showScreen('screen-about')">Back to Game üîô</button>
            </div>
        </div>

        <!-- Parent Dashboard -->
        <div id="screen-parent" class="screen">
            <div class="card">
                <h2>üìà Learning Overview</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Play Time</div>
                        <div class="stat-number" id="parent-total-time">0m</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Missions Completed</div>
                        <div class="stat-number" id="parent-total-missions">0</div>
                        <div style="font-size: 0.9em; color: #666;">Out of 12</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Current Level</div>
                        <div class="stat-number" id="parent-level">1</div>
                        <div style="font-size: 0.9em; color: #666;" id="parent-title">Trainee</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Brain Power</div>
                        <div class="stat-number" id="parent-crystals">0</div>
                        <div style="font-size: 0.9em; color: #666;">Crystals earned</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Skill Development</h2>
                <div class="skill-bar">
                    <div class="skill-header">
                        <span>‚ö° Focus & Attention</span>
                        <span id="parent-score-focus">0/10</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill fill-focus" id="parent-bar-focus" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="skill-bar">
                    <div class="skill-header">
                        <span>üå± Memory & Retention</span>
                        <span id="parent-score-memory">0/10</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill fill-memory" id="parent-bar-memory" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="skill-bar">
                    <div class="skill-header">
                        <span>üí™ Challenge & Resilience</span>
                        <span id="parent-score-challenge">0/10</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill fill-challenge" id="parent-bar-challenge" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="skill-bar">
                    <div class="skill-header">
                        <span>üó∫Ô∏è Planning & Organization</span>
                        <span id="parent-score-plan">0/10</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill fill-plan" id="parent-bar-plan" style="width: 0%">0%</div>
                    </div>
                </div>
                
                <div class="comparison-chart" id="skill-chart">
                    <div class="chart-bar fill-focus" data-value="0" style="height: 0%">
                        <span class="chart-label">Focus</span>
                    </div>
                    <div class="chart-bar fill-memory" data-value="0" style="height: 0%">
                        <span class="chart-label">Memory</span>
                    </div>
                    <div class="chart-bar fill-challenge" data-value="0" style="height: 0%">
                        <span class="chart-label">Challenge</span>
                    </div>
                    <div class="chart-bar fill-plan" data-value="0" style="height: 0%">
                        <span class="chart-label">Plan</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üîç Smart Insights</h2>
                <div id="insights-container">
                    <div class="insight-box">
                        <strong>üåü Ready to Start!</strong>
                        Your child hasn't begun their adventure yet. Encourage them to try their first mission!
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üí° Personalized Parent Tips</h2>
                <div id="tips-container"></div>
                
                <div class="toggle-container">
                    <span>Show offline activity ideas</span>
                    <div class="toggle" id="offline-toggle" onclick="toggleOffline()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div id="offline-ideas" class="hidden">
                    <div class="tip-card">
                        <h4>Focus Falls - Offline Activity</h4>
                        <p><strong>Spotlight Scavenger Hunt:</strong> Give your child a flashlight. Hide 5 soft toys around a darkened room. They must keep the light on each toy for 5 seconds while you make distracting noises.</p>
                        <div class="tip-action">Ask afterwards: "What happened when you heard the noise? How did you bring your attention back?"</div>
                    </div>
                    
                    <div class="tip-card">
                        <h4>Memory Meadows - Offline Activity</h4>
                        <p><strong>Shopping List Game:</strong> Start with "I went to the store and bought..." Take turns adding items. See how many you can remember in order!</p>
                        <div class="tip-action">Strategy tip: Encourage your child to "make a movie in their mind" of the items interacting.</div>
                    </div>
                    
                    <div class="tip-card">
                        <h4>Challenge Canyon - Offline Activity</h4>
                        <p><strong>The Tower of YET:</strong> Build a card tower together. When it falls, practice saying "It didn't work... YET!" and try a different technique.</p>
                        <div class="tip-action">Model making mistakes yourself and verbalize your thinking: "Hmm, that didn't work. What else could I try?"</div>
                    </div>
                    
                    <div class="tip-card">
                        <h4>Plan Peak - Offline Activity</h4>
                        <p><strong>Morning Routine Map:</strong> Draw pictures of morning tasks (wake up, dress, breakfast, brush teeth). Let your child arrange them in order.</p>
                        <div class="tip-action">Use "First/Then" language: "First we put on shoes, then we can play."</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìÖ Recent Activity</h2>
                <div class="timeline" id="activity-timeline"></div>
                <div id="no-activity" class="text-center" style="color: #888; padding: 20px;">
                    No activities recorded yet.
                </div>
            </div>

            <div class="card">
                <h2>üìã Weekly Summary</h2>
                <div id="weekly-report">
                    <p><strong>Strengths:</strong> <span id="strengths">Not enough data yet</span></p>
                    <p><strong>Growth Areas:</strong> <span id="growth-areas">Not enough data yet</span></p>
                    <p><strong>Recommended Focus:</strong> <span id="recommendation">Try any island to begin!</span></p>
                </div>
                <div class="text-center mt-20">
                    <button class="btn btn-green" onclick="exportData()">Export Data üìä</button>
                    <button class="btn" onclick="showScreen('screen-about')">Back to Game üîô</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            name: '',
            avatar: 'ü¶Å',
            level: 1,
            title: 'Trainee',
            stats: {
                focus: 0,
                memory: 0,
                challenge: 0,
                plan: 0
            },
            missionsCompleted: {
                focus: 0,
                memory: 0,
                challenge: 0,
                plan: 0
            },
            crystals: 0,
            playTime: 0,
            sessions: [],
            currentMission: null,
            badges: []
        };

        // Mission Data
        const missions = {
            focus: [
                {
                    title: "The Laser Bridge",
                    desc: "Keep your spotlight steady while crossing the bridge!",
                    task: "Click the stars to collect them. Don't get distracted by the floating shapes!",
                    type: "spotlight",
                    reflection: "What happened when you got distracted? How did you bring your attention back?"
                },
                {
                    title: "Sound Hunter",
                    desc: "Train your ears to focus on important sounds.",
                    task: "Watch the pattern of sounds, then repeat it by clicking the buttons in order.",
                    type: "pattern",
                    reflection: "Did you say the pattern quietly in your head to remember it?"
                },
                {
                    title: "Focus Fuel",
                    desc: "Even explorers need breaks to recharge!",
                    task: "Do 10 jumping jacks, then count backwards from 20 as fast as you can.",
                    type: "physical",
                    reflection: "How did your body feel after moving? Was it easier to focus?"
                }
            ],
            memory: [
                {
                    title: "Seed Planting",
                    desc: "Plant memories in your garden so they grow strong!",
                    task: "Match the pairs. When you find a match, imagine drawing it in your memory garden!",
                    type: "matching",
                    reflection: "Did making a picture in your head help you remember where cards were?"
                },
                {
                    title: "Teach the Stuffy",
                    desc: "Teaching others helps your own brain learn better!",
                    task: "Memorize this joke, then tell it to your favorite toy: Why did the scarecrow win an award? Because he was outstanding in his field!",
                    type: "teach",
                    reflection: "How did it feel to teach someone else? Did you understand the joke better?"
                },
                {
                    title: "Memory Watering",
                    desc: "Good memories need to be visited again and again!",
                    task: "Look at 5 items for 10 seconds, wait 10 seconds, then recall them.",
                    type: "recall",
                    reflection: "Which items were easiest to remember? Why do you think that is?"
                }
            ],
            challenge: [
                {
                    title: "The Learning Pit",
                    desc: "Getting stuck is just your brain growing stronger!",
                    task: "Solve this puzzle: Arrange numbers 1-4 so each row and column has no repeats.",
                    type: "puzzle",
                    reflection: "What did you try when you got stuck? How did it feel to keep trying?"
                },
                {
                    title: "Yet Tower",
                    desc: "Add the magic word 'YET' to everything!",
                    task: "Build a tower. If it falls, say 'I haven't built it YET!' and try a different way.",
                    type: "tower",
                    reflection: "How did saying 'yet' change how you felt about the mistake?"
                },
                {
                    title: "Mistake Museum",
                    desc: "Our best learning comes from oops moments!",
                    task: "Think of a recent mistake. What did you learn from it?",
                    type: "reflect",
                    reflection: "Was it hard to think about a mistake? What did you learn that you won't forget?"
                }
            ],
            plan: [
                {
                    title: "Treasure Hunt Map",
                    desc: "Good explorers always make a plan before starting!",
                    task: "Drag the steps into the right order: Find the key, Open the chest, Get the gold.",
                    type: "sequence",
                    reflection: "What would happen if you tried to open the chest before finding the key?"
                },
                {
                    title: "First/Then Train",
                    desc: "Doing things in order helps us succeed!",
                    task: "Sort these morning items: Wake up, Eat breakfast, Brush teeth, Get dressed.",
                    type: "sort",
                    reflection: "Why is it important to wake up before eating breakfast?"
                },
                {
                    title: "Plan B",
                    desc: "Sometimes plans change and we need to adapt!",
                    task: "You planned to play outside but it's raining! What indoor activities could you do?",
                    type: "adapt",
                    reflection: "How did it feel when the plan changed? Was it easy to think of new ideas?"
                }
            ]
        };

        // Initialize
        document.querySelectorAll('.avatar-option').forEach(avatar => {
            avatar.addEventListener('click', function() {
                document.querySelectorAll('.avatar-option').forEach(a => a.classList.remove('selected'));
                this.classList.add('selected');
                gameState.avatar = this.dataset.avatar;
            });
        });

        function loadGame() {
            const saved = localStorage.getItem('brainExplorerData');
            if (saved) {
                const parsed = JSON.parse(saved);
                // Merge with defaults to ensure all fields exist
                gameState = { ...gameState, ...parsed };
                if (!gameState.badges) gameState.badges = [];
                if (!gameState.sessions) gameState.sessions = [];
                if (gameState.name) {
                    updateDashboard();
                    showScreen('screen-dashboard');
                    return true;
                }
            }
            return false;
        }

        function saveGame() {
            localStorage.setItem('brainExplorerData', JSON.stringify(gameState));
        }

        function createExplorer() {
            const nameInput = document.getElementById('explorer-name');
            if (!nameInput.value.trim()) {
                alert('Please enter your explorer name!');
                return;
            }
            gameState.name = nameInput.value.trim();
            saveGame();
            updateDashboard();
            showScreen('screen-dashboard');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'screen-parent') {
                updateParentDashboard();
            }
        }

        function updateDashboard() {
            document.getElementById('dash-avatar').textContent = gameState.avatar;
            document.getElementById('dash-name').textContent = gameState.name;
            document.getElementById('dash-level').textContent = `Level ${gameState.level} ${gameState.title}`;
            
            for (let stat in gameState.stats) {
                document.getElementById(`stat-${stat}`).textContent = gameState.stats[stat];
                document.getElementById(`bar-${stat}`).style.width = (gameState.stats[stat] * 10) + '%';
                document.getElementById(`count-${stat}`).textContent = gameState.missionsCompleted[stat];
                document.getElementById(`prog-${stat}`).style.width = (gameState.missionsCompleted[stat] / 3 * 100) + '%';
            }
            
            document.getElementById('crystal-count').textContent = gameState.crystals;
            checkLevelUp();
        }

        function checkLevelUp() {
            const totalMissions = Object.values(gameState.missionsCompleted).reduce((a, b) => a + b, 0);
            if (totalMissions >= 12 && gameState.level < 3) {
                gameState.level = 3;
                gameState.title = 'Master';
            } else if (totalMissions >= 6 && gameState.level < 2) {
                gameState.level = 2;
                gameState.title = 'Ranger';
            }
        }

        function startMission(type) {
            const missionIndex = gameState.missionsCompleted[type];
            if (missionIndex >= missions[type].length) {
                alert('You have completed all missions on this island! Great job! Try another island!');
                return;
            }
            
            gameState.currentMission = { type, index: missionIndex };
            const mission = missions[type][missionIndex];
            
            const colors = {
                focus: 'focus-blue',
                memory: 'memory-green',
                challenge: 'challenge-orange',
                plan: 'plan-purple'
            };
            
            let html = `
                <div class="mission-card" style="border-color: var(--${colors[type]})">
                    <div class="mission-title">${mission.title}</div>
                    <div class="mission-desc">${mission.desc}</div>
                    <div class="mission-task">
                        <strong>Your Mission:</strong> ${mission.task}
                    </div>
                </div>
                <div class="game-area" id="game-play-area">
                    ${getGameHTML(type, mission.type)}
                </div>
            `;
            
            document.getElementById('mission-content').innerHTML = html;
            showScreen('screen-mission');
            
            setTimeout(() => initGame(type, mission.type), 100);
        }

        function getGameHTML(type, gameType) {
            switch(gameType) {
                case 'spotlight':
                    return '<div class="spotlight-area" id="spotlight-game"></div><p style="margin-top: 15px;">Click 10 stars to win! Avoid distractions!</p>';
                case 'matching':
                    return '<div class="memory-grid" id="memory-game"></div><p style="margin-top: 15px;">Find all matching pairs!</p>';
                case 'sequence':
                case 'sort':
                    return '<ul class="task-list" id="sortable-list"></ul><button class="btn mt-20" onclick="checkOrder()">Check Order ‚úì</button>';
                case 'puzzle':
                    return '<div id="puzzle-game" style="font-size: 1.2em;"><p>Click cells to change numbers. No repeats in rows or columns!</p><div id="sudoku-grid" style="margin-top: 20px;"></div></div>';
                case 'pattern':
                    return '<div id="pattern-game"><div id="pattern-display" style="font-size: 2em; margin: 20px; min-height: 50px;">Watch...</div><div id="pattern-buttons" style="margin: 20px;"></div></div>';
                default:
                    return '<div style="padding: 40px; text-align: center;"><p>Complete this mission with a grown-up!</p><button class="btn btn-green" onclick="completeMission()">I Did It! ‚úì</button></div>';
            }
        }

        // Game Variables
        let starsCollected = 0;
        let memoryMatches = 0;
        let flippedCards = [];
        let canFlip = true;
        let currentOrder = [];
        let puzzleGrid = [[0,0],[0,0]];
        let patternSequence = [];
        let playerPattern = [];

        function initGame(type, gameType) {
            if (gameType === 'spotlight') initSpotlight();
            else if (gameType === 'matching') initMemory();
            else if (gameType === 'sequence' || gameType === 'sort') initSortable(type);
            else if (gameType === 'puzzle') initPuzzle();
            else if (gameType === 'pattern') initPattern();
        }

        function initSpotlight() {
            starsCollected = 0;
            const area = document.getElementById('spotlight-game');
            area.innerHTML = '';
            
            function spawnStar() {
                if (starsCollected >= 10) {
                    completeMission();
                    return;
                }
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = '‚≠ê';
                star.style.left = Math.random() * 80 + 10 + '%';
                star.style.top = Math.random() * 80 + 10 + '%';
                star.onclick = () => {
                    starsCollected++;
                    star.remove();
                    spawnDistraction();
                    if (starsCollected < 10) setTimeout(spawnStar, 600);
                    else completeMission();
                };
                area.appendChild(star);
                setTimeout(() => { if(star.parentNode) star.remove(); }, 2000);
            }
            
            function spawnDistraction() {
                const distractions = ['ü¶ã', 'üéà', 'üå∏', 'üí´'];
                const dist = document.createElement('div');
                dist.className = 'distraction';
                dist.textContent = distractions[Math.floor(Math.random() * distractions.length)];
                dist.style.left = Math.random() * 80 + 10 + '%';
                dist.style.top = Math.random() * 80 + 10 + '%';
                area.appendChild(dist);
                setTimeout(() => { if(dist.parentNode) dist.remove(); }, 3000);
            }
            
            spawnStar();
        }

        function initMemory() {
            memoryMatches = 0;
            flippedCards = [];
            canFlip = true;
            const grid = document.getElementById('memory-game');
            const emojis = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä'];
            const pairs = [...emojis, ...emojis];
            
            for (let i = pairs.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pairs[i], pairs[j]] = [pairs[j], pairs[i]];
            }
            
            grid.innerHTML = '';
            pairs.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.emoji = emoji;
                card.textContent = '?';
                card.onclick = () => flipCard(card, emoji);
                grid.appendChild(card);
            });
        }

        function flipCard(card, emoji) {
            if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) return;
            
            card.textContent = emoji;
            card.classList.add('flipped');
            flippedCards.push({card, emoji});
            
            if (flippedCards.length === 2) {
                canFlip = false;
                setTimeout(checkMatch, 800);
            }
        }

        function checkMatch() {
            const [first, second] = flippedCards;
            if (first.emoji === second.emoji) {
                first.card.classList.add('matched');
                second.card.classList.add('matched');
                memoryMatches++;
                if (memoryMatches === 6) {
                    setTimeout(completeMission, 500);
                }
            } else {
                first.card.textContent = '?';
                second.card.textContent = '?';
                first.card.classList.remove('flipped');
                second.card.classList.remove('flipped');
            }
            flippedCards = [];
            canFlip = true;
        }

        function initSortable(type) {
            const list = document.getElementById('sortable-list');
            let items = [];
            
            if (type === 'sequence') {
                items = [
                    {text: 'Get the gold', correct: 3},
                    {text: 'Find the key', correct: 1},
                    {text: 'Open the chest', correct: 2}
                ];
            } else {
                items = [
                    {text: 'Wake up', correct: 1},
                    {text: 'Eat breakfast', correct: 2},
                    {text: 'Brush teeth', correct: 3},
                    {text: 'Get dressed', correct: 4}
                ];
            }
            
            currentOrder = items.map(item => ({...item}));
            currentOrder.sort(() => Math.random() - 0.5);
            renderSortable();
        }

        function renderSortable() {
            const list = document.getElementById('sortable-list');
            list.innerHTML = '';
            currentOrder.forEach((item, idx) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.innerHTML = `
                    <span class="task-number">${idx + 1}</span>
                    <span>${item.text}</span>
                    <button onclick="moveItem(${idx}, -1)" style="margin-left: auto; background: none; border: none; font-size: 1.2em; cursor: pointer;">‚¨ÜÔ∏è</button>
                    <button onclick="moveItem(${idx}, 1)" style="background: none; border: none; font-size: 1.2em; cursor: pointer;">‚¨áÔ∏è</button>
                `;
                list.appendChild(li);
            });
        }

        function moveItem(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= currentOrder.length) return;
            [currentOrder[index], currentOrder[newIndex]] = [currentOrder[newIndex], currentOrder[index]];
            renderSortable();
        }

        function checkOrder() {
            const isCorrect = currentOrder.every((item, idx) => item.correct === idx + 1);
            if (isCorrect) {
                alert('Perfect order! Great planning! üéâ');
                completeMission();
            } else {
                alert('Not quite right. Think about what must come first!');
            }
        }

        function initPuzzle() {
            puzzleGrid = [[1,2],[2,1]];
            renderPuzzle();
        }

        function renderPuzzle() {
            const container = document.getElementById('sudoku-grid');
            container.innerHTML = '';
            container.style.display = 'grid';
            container.style.gridTemplateColumns = 'repeat(2, 70px)';
            container.style.gap = '10px';
            container.style.justifyContent = 'center';
            
            for (let row = 0; row < 2; row++) {
                for (let col = 0; col < 2; col++) {
                    const cell = document.createElement('div');
                    cell.style.cssText = 'width:70px;height:70px;border:3px solid var(--challenge-orange);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.5em;cursor:pointer;background:white;';
                    cell.textContent = puzzleGrid[row][col];
                    cell.onclick = () => {
                        puzzleGrid[row][col] = (puzzleGrid[row][col] % 4) + 1;
                        renderPuzzle();
                        checkPuzzle();
                    };
                    container.appendChild(cell);
                }
            }
        }

        function checkPuzzle() {
            const valid = puzzleGrid[0][0] !== puzzleGrid[0][1] && 
                         puzzleGrid[1][0] !== puzzleGrid[1][1] &&
                         puzzleGrid[0][0] !== puzzleGrid[1][0] &&
                         puzzleGrid[0][1] !== puzzleGrid[1][1];
            if (valid) {
                setTimeout(() => {
                    alert('You solved it! Great persistence! üéâ');
                    completeMission();
                }, 300);
            }
        }

        function initPattern() {
            patternSequence = [];
            playerPattern = [];
            const buttons = ['üî¥', 'üîµ', 'üü¢', 'üü°'];
            const display = document.getElementById('pattern-display');
            const btnContainer = document.getElementById('pattern-buttons');
            
            for (let i = 0; i < 3; i++) {
                patternSequence.push(Math.floor(Math.random() * 4));
            }
            
            let i = 0;
            display.textContent = 'Watch...';
            
            const interval = setInterval(() => {
                if (i >= patternSequence.length) {
                    clearInterval(interval);
                    display.textContent = 'Your turn! Repeat the pattern';
                    showPatternButtons();
                    return;
                }
                display.textContent = buttons[patternSequence[i]];
                setTimeout(() => display.textContent = '', 400);
                i++;
            }, 800);
            
            function showPatternButtons() {
                btnContainer.innerHTML = '';
                buttons.forEach((btn, idx) => {
                    const button = document.createElement('button');
                    button.textContent = btn;
                    button.style.cssText = 'font-size:2em;margin:10px;padding:15px;border:none;border-radius:10px;cursor:pointer;';
                    button.onclick = () => {
                        playerPattern.push(idx);
                        if (playerPattern[playerPattern.length - 1] !== patternSequence[playerPattern.length - 1]) {
                            alert('Oops! That was not quite right. Try again!');
                            playerPattern = [];
                            initPattern();
                            return;
                        }
                        if (playerPattern.length === patternSequence.length) {
                            setTimeout(() => {
                                alert('Perfect focus! You remembered the pattern! üéâ');
                                completeMission();
                            }, 300);
                        }
                    };
                    btnContainer.appendChild(button);
                });
            }
        }

        function completeMission() {
            const { type, index } = gameState.currentMission;
            const mission = missions[type][index];
            
            const html = `
                <div class="reflection">
                    <h3>ü§î Brain Reflection Time</h3>
                    <p style="margin-bottom: 15px;"><strong>${mission.reflection}</strong></p>
                    <div class="reflection-options">
                        <button class="reflection-btn" onclick="finishReflection('noticed')">I noticed my attention wandering, then I brought it back!</button>
                        <button class="reflection-btn" onclick="finishReflection('kept')">I felt frustrated but kept trying!</button>
                        <button class="reflection-btn" onclick="finishReflection('picture')">I made a picture in my head to help me!</button>
                        <button class="reflection-btn" onclick="finishReflection('steps')">I broke it into smaller steps!</button>
                    </div>
                </div>
            `;
            document.getElementById('mission-content').innerHTML = html;
        }

        function finishReflection(answer) {
            const { type } = gameState.currentMission;
            gameState.missionsCompleted[type]++;
            gameState.stats[type] = Math.min(10, gameState.stats[type] + 2);
            gameState.crystals += 2;
            
            gameState.sessions.unshift({
                date: new Date().toISOString().split('T')[0],
                island: type,
                mission: missions[type][gameState.missionsCompleted[type]-1].title,
                reflection: answer
            });
            
            if (gameState.missionsCompleted[type] === 3 && !gameState.badges.includes(type)) {
                gameState.badges.push(type);
            }
            
            if (gameState.badges.length === 4 && !gameState.badges.includes('master')) {
                gameState.badges.push('master');
            }
            
            saveGame();
            showReward();
        }

        function showReward() {
            const { type } = gameState.currentMission;
            const messages = {
                focus: "Your Focus Power leveled up! üî¶‚ú®",
                memory: "Your Memory Garden grew! üå±‚ú®",
                challenge: "You conquered the Learning Pit! üßó‚ú®",
                plan: "You drew a perfect Treasure Map! üó∫Ô∏è‚ú®"
            };
            
            document.getElementById('reward-message').innerHTML = `
                <p style="font-size: 1.3em; color: #555; margin-bottom: 20px;">${messages[type]}</p>
                <p>You earned 2 Power Crystals! üíéüíé</p>
            `;
            
            document.querySelectorAll('#badges-display .badge').forEach(badge => {
                badge.classList.remove('earned');
            });
            
            gameState.badges.forEach(badge => {
                const el = document.getElementById(`badge-${badge}`);
                if (el) el.classList.add('earned');
            });
            
            for (let i = 0; i < 30; i++) {
                setTimeout(createConfetti, i * 50);
            }
            
            showScreen('screen-reward');
        }

        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.background = ['#FFD93D', '#4ECDC4', '#F38181', '#AA96DA', '#2A9D8F'][Math.floor(Math.random() * 5)];
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }

        function returnToDashboard() {
            updateDashboard();
            showScreen('screen-dashboard');
        }

        function viewBadges() {
            const container = document.getElementById('full-badge-collection');
            const badgeData = [
                {id: 'focus', icon: 'üî¶', name: 'Focus Master', desc: 'Complete all Focus Falls missions'},
                {id: 'memory', icon: 'üå±', name: 'Memory Gardener', desc: 'Complete all Memory Meadows missions'},
                {id: 'challenge', icon: 'üßó', name: 'Puzzle Solver', desc: 'Complete all Challenge Canyon missions'},
                {id: 'plan', icon: 'üó∫Ô∏è', name: 'Map Maker', desc: 'Complete all Plan Peak missions'},
                {id: 'master', icon: 'üß†', name: 'Brain Master', desc: 'Earn all other badges'}
            ];
            
            container.innerHTML = badgeData.map(badge => `
                <div style="display: flex; align-items: center; gap: 20px; background: ${gameState.badges.includes(badge.id) ? 'linear-gradient(135deg, #fff9e6, #fff)' : '#f5f5f5'}; 
                            padding: 20px; border-radius: 15px; width: 100%; max-width: 400px;
                            border: 3px solid ${gameState.badges.includes(badge.id) ? 'var(--gold)' : '#ddd'}; margin-bottom: 10px;">
                    <div style="font-size: 3em; opacity: ${gameState.badges.includes(badge.id) ? 1 : 0.3};">${badge.icon}</div>
                    <div style="text-align: left;">
                        <div style="font-family: 'Fredoka One', cursive; font-size: 1.3em; color: ${gameState.badges.includes(badge.id) ? 'var(--dark)' : '#999'};">
                            ${badge.name} ${gameState.badges.includes(badge.id) ? '‚úì' : 'üîí'}
                        </div>
                        <div style="color: #666; font-size: 0.9em;">${badge.desc}</div>
                    </div>
                </div>
            `).join('');
            
            showScreen('screen-badges');
        }

        function resetGame() {
            if (confirm('Start over with a new explorer? Your current progress will be saved separately.')) {
                localStorage.setItem('brainExplorerBackup', JSON.stringify(gameState));
                gameState = {
                    name: '',
                    avatar: 'ü¶Å',
                    level: 1,
                    title: 'Trainee',
                    stats: { focus: 0, memory: 0, challenge: 0, plan: 0 },
                    missionsCompleted: { focus: 0, memory: 0, challenge: 0, plan: 0 },
                    crystals: 0,
                    playTime: 0,
                    sessions: [],
                    currentMission: null,
                    badges: []
                };
                saveGame();
                showScreen('screen-create');
            }
        }

        // Parent Dashboard Functions
        function showParentGate() {
            showScreen('screen-parent-gate');
            document.getElementById('pin1').focus();
        }

        function movePin(n) {
            if (n < 4) document.getElementById(`pin${n+1}`).focus();
        }

        function checkPin() {
            const pin = document.getElementById('pin1').value + 
                       document.getElementById('pin2').value + 
                       document.getElementById('pin3').value + 
                       document.getElementById('pin4').value;
            
            if (pin === '1234') {
                for(let i=1; i<=4; i++) document.getElementById(`pin${i}`).value = '';
                showScreen('screen-parent');
            } else {
                alert('Incorrect PIN. Try 1234');
            }
        }

        function updateParentDashboard() {
            document.getElementById('parent-total-time').textContent = (gameState.playTime || 0) + 'm';
            const totalMissions = Object.values(gameState.missionsCompleted).reduce((a,b) => a+b, 0);
            document.getElementById('parent-total-missions').textContent = totalMissions;
            document.getElementById('parent-level').textContent = gameState.level;
            document.getElementById('parent-title').textContent = gameState.title;
            document.getElementById('parent-crystals').textContent = gameState.crystals;

            const maxScore = 10;
            for (let skill in gameState.stats) {
                const score = gameState.stats[skill];
                const percent = (score / maxScore) * 100;
                document.getElementById(`parent-score-${skill}`).textContent = `${score}/${maxScore}`;
                const bar = document.getElementById(`parent-bar-${skill}`);
                bar.style.width = percent + '%';
                bar.textContent = percent > 15 ? Math.round(percent) + '%' : '';
            }

            const chartBars = document.querySelectorAll('#skill-chart .chart-bar');
            const skills = ['focus', 'memory', 'challenge', 'plan'];
            chartBars.forEach((bar, idx) => {
                const score = gameState.stats[skills[idx]];
                bar.style.height = (score / maxScore * 100) + '%';
                bar.setAttribute('data-value', score);
            });

            generateInsights();
            generateTips();
            updateTimeline();
            generateWeeklyReport();
        }

        function generateInsights() {
            const container = document.getElementById('insights-container');
            const insights = [];
            const totalMissions = Object.values(gameState.missionsCompleted).reduce((a,b) => a+b, 0);
            
            if (totalMissions === 0) {
                container.innerHTML = `
                    <div class="insight-box">
                        <strong>üåü Ready to Start!</strong>
                        Your child hasn't begun their adventure yet. Encourage them to explore Focus Falls first!
                    </div>`;
                return;
            }

            let strongest = Object.entries(gameState.stats).sort((a,b) => b[1]-a[1])[0];
            insights.push({
                icon: 'üèÜ',
                title: 'Strongest Skill',
                text: `Your child shows great strength in ${strongest[0]} (${strongest[1]}/10).`,
                color: '#4CAF50'
            });

            let weakest = Object.entries(gameState.stats).sort((a,b) => a[1]-b[1])[0];
            if (weakest[1] < 5) {
                insights.push({
                    icon: 'üå±',
                    title: 'Growth Opportunity',
                    text: `${weakest[0].charAt(0).toUpperCase() + weakest[0].slice(1)} could use more practice.`,
                    color: '#FF9800'
                });
            }

            if (gameState.sessions.length >= 3) {
                insights.push({
                    icon: 'ü§î',
                    title: 'Metacognition Growing',
                    text: `Your child is articulating their learning strategies!`,
                    color: '#9C27B0'
                });
            }

            container.innerHTML = insights.map(i => `
                <div class="insight-box" style="border-left-color: ${i.color}; background: linear-gradient(135deg, ${i.color}15 0%, ${i.color}08 100%);">
                    <strong>${i.icon} ${i.title}</strong>
                    ${i.text}
                </div>
            `).join('');
        }

        function generateTips() {
            const container = document.getElementById('tips-container');
            const tips = [];
            
            if (gameState.stats.challenge > gameState.stats.focus + 2) {
                tips.push({
                    title: 'Balance Persistence with Flexibility',
                    content: 'Your child shows great resilience but may benefit from strategies to know WHEN to take a break.',
                    action: 'Practice the "3-Then-Break" rule during homework.'
                });
            }

            if (gameState.stats.plan < 4) {
                tips.push({
                    title: 'Visual Planning Support',
                    content: 'Planning skills are still developing. Use visual schedules with pictures.',
                    action: 'Create a "First/Then" board for daily routines.'
                });
            }

            tips.push({
                title: 'The Power of "Yet" at Age 6',
                content: 'Six-year-olds are developing "theory of mind" and can understand that abilities grow.',
                action: 'Model "yet" in your own speech: "I haven\'t figured this out... yet!"'
            });

            container.innerHTML = tips.map(t => `
                <div class="tip-card">
                    <h4>${t.title}</h4>
                    <p>${t.content}</p>
                    <div class="tip-action"><strong>Try this:</strong> ${t.action}</div>
                </div>
            `).join('');
        }

        function updateTimeline() {
            const container = document.getElementById('activity-timeline');
            const noActivity = document.getElementById('no-activity');
            
            if (!gameState.sessions || gameState.sessions.length === 0) {
                container.innerHTML = '';
                noActivity.classList.remove('hidden');
                return;
            }
            
            noActivity.classList.add('hidden');
            
            container.innerHTML = gameState.sessions.slice(0, 10).map(s => `
                <div class="timeline-item timeline-${s.island}">
                    <div class="timeline-date">${formatDate(s.date)}</div>
                    <div class="timeline-title">${s.mission}</div>
                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                        <strong>Reflection:</strong> ${s.reflection}
                    </div>
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const diff = Math.floor((today - date) / (1000 * 60 * 60 * 24));
            
            if (diff === 0) return 'Today';
            if (diff === 1) return 'Yesterday';
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        function generateWeeklyReport() {
            const skills = Object.entries(gameState.stats);
            const strongest = skills.sort((a,b) => b[1]-a[1])[0];
            const weakest = skills.sort((a,b) => a[1]-b[1])[0];
            
            document.getElementById('strengths').textContent = strongest[1] > 0 ? 
                `${strongest[0].charAt(0).toUpperCase() + strongest[0].slice(1)} (${strongest[1]}/10)` : 'Not enough data';
            
            document.getElementById('growth-areas').textContent = weakest[1] < 5 && weakest[1] > 0 ? 
                `${weakest[0].charAt(0).toUpperCase() + weakest[0].slice(1)} needs practice` : 'All skills developing';
            
            let rec = 'Try any island to begin!';
            const total = Object.values(gameState.missionsCompleted).reduce((a,b)=>a+b,0);
            if (weakest[1] < 4 && weakest[1] > 0) {
                rec = `Focus on ${weakest[0]} activities this week.`;
            } else if (total > 6) {
                rec = 'Great progress! Encourage teaching these skills to a sibling.';
            }
            document.getElementById('recommendation').textContent = rec;
        }

        function toggleOffline() {
            const toggle = document.getElementById('offline-toggle');
            const ideas = document.getElementById('offline-ideas');
            toggle.classList.toggle('active');
            ideas.classList.toggle('hidden');
        }

        function exportData() {
            const report = {
                childName: gameState.name,
                exportDate: new Date().toLocaleDateString(),
                summary: {
                    totalPlayTime: gameState.playTime + ' minutes',
                    missionsCompleted: Object.values(gameState.missionsCompleted).reduce((a,b) => a+b, 0),
                    currentLevel: `Level ${gameState.level} ${gameState.title}`,
                    totalCrystals: gameState.crystals
                },
                skills: gameState.stats,
                recentActivity: gameState.sessions.slice(0, 5)
            };
            
            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `BrainExplorer_${gameState.name}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Initialize
        window.onload = () => {
            const hasSaved = loadGame();
            if (!hasSaved) {
                showScreen('screen-about');
            }
        };
    </script>
</body>
</html>
