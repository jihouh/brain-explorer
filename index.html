<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Explorer Academy</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --focus-blue: #4ECDC4;
            --memory-green: #95E1D3;
            --challenge-orange: #F38181;
            --plan-purple: #AA96DA;
            --gold: #FFD93D;
            --dark: #2C3E50;
            --light: #F7F9FC;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .game-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .game-header h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 3em;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        /* Screens */
        .screen {
            display: none;
            background: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Character Creation */
        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .avatar-option {
            font-size: 3em;
            padding: 20px;
            border: 4px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light);
            text-align: center;
        }
        
        .avatar-option:hover {
            transform: scale(1.1);
            border-color: var(--gold);
        }
        
        .avatar-option.selected {
            border-color: var(--gold);
            background: #fff9e6;
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
        }
        
        .name-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #ddd;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Nunito', sans-serif;
            text-align: center;
        }
        
        .name-input:focus {
            outline: none;
            border-color: var(--focus-blue);
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--focus-blue), #3dbdb4);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
            margin: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.6);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-orange {
            background: linear-gradient(135deg, var(--challenge-orange), #e85a5a);
            box-shadow: 0 4px 15px rgba(243, 129, 129, 0.4);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, var(--plan-purple), #8b7bc7);
            box-shadow: 0 4px 15px rgba(170, 150, 218, 0.4);
        }
        
        .btn-green {
            background: linear-gradient(135deg, var(--memory-green), #7bc4b5);
            box-shadow: 0 4px 15px rgba(149, 225, 211, 0.4);
            color: var(--dark);
        }
        
        /* Dashboard */
        .explorer-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .explorer-avatar {
            font-size: 4em;
            background: white;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .explorer-info h2 {
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .level-badge {
            background: var(--gold);
            color: var(--dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat {
            background: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9em;
        }
        
        .stat-bar {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .stat-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        /* Islands Map */
        .islands-map {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .island {
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .island::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .island:hover::before {
            opacity: 1;
        }
        
        .island:hover {
            transform: translateY(-5px) scale(1.02);
        }
        
        .island-locked {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(0.5);
        }
        
        .island-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .island h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .island-progress {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .island-progress-bar {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.5s;
        }
        
        .focus-island { background: linear-gradient(135deg, var(--focus-blue), #3dbdb4); color: white; }
        .memory-island { background: linear-gradient(135deg, var(--memory-green), #7bc4b5); color: var(--dark); }
        .challenge-island { background: linear-gradient(135deg, var(--challenge-orange), #e85a5a); color: white; }
        .plan-island { background: linear-gradient(135deg, var(--plan-purple), #8b7bc7); color: white; }
        
        /* Mission Screen */
        .mission-container {
            text-align: center;
        }
        
        .mission-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border-left: 8px solid;
        }
        
        .mission-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8em;
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .mission-desc {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
        }
        
        .mission-task {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .timer {
            font-size: 2em;
            font-family: 'Fredoka One', cursive;
            color: var(--challenge-orange);
            margin: 20px 0;
        }
        
        .game-area {
            min-height: 200px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }
        
        /* Memory Game Specific */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--focus-blue), #3dbdb4);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            transform-style: preserve-3d;
        }
        
        .memory-card:hover {
            transform: scale(1.05);
        }
        
        .memory-card.flipped {
            background: white;
            border: 3px solid var(--focus-blue);
        }
        
        .memory-card.matched {
            background: var(--memory-green);
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Focus Game Specific */
        .spotlight-area {
            position: relative;
            height: 300px;
            background: #2C3E50;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .distraction {
            position: absolute;
            font-size: 1.5em;
            opacity: 0.7;
            animation: float-around 4s infinite linear;
        }
        
        @keyframes float-around {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(50px, -30px) rotate(90deg); }
            50% { transform: translate(0, -60px) rotate(180deg); }
            75% { transform: translate(-50px, -30px) rotate(270deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }
        
        /* Challenge Game Specific */
        .puzzle-piece {
            display: inline-block;
            width: 60px;
            height: 60px;
            background: var(--challenge-orange);
            margin: 5px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
            cursor: move;
            transition: all 0.3s;
        }
        
        .puzzle-piece:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .puzzle-slot {
            width: 60px;
            height: 60px;
            border: 3px dashed #ccc;
            margin: 5px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: top;
        }
        
        .puzzle-slot.filled {
            border-color: var(--memory-green);
            background: rgba(149, 225, 211, 0.3);
        }
        
        /* Plan Game Specific */
        .task-list {
            list-style: none;
            text-align: left;
        }
        
        .task-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid var(--plan-purple);
            cursor: move;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .task-number {
            background: var(--plan-purple);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Reflection Section */
        .reflection {
            background: #fff9e6;
            border: 3px solid var(--gold);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .reflection h3 {
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .reflection-options {
            display: grid;
            gap: 10px;
        }
        
        .reflection-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
            font-size: 1em;
        }
        
        .reflection-btn:hover {
            border-color: var(--gold);
            background: #fffef5;
        }
        
        .reflection-btn.selected {
            border-color: var(--gold);
            background: var(--gold);
            color: var(--dark);
        }
        
        /* Rewards */
        .crystal {
            display: inline-block;
            font-size: 2em;
            animation: sparkle 2s infinite;
            margin: 0 5px;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
        }
        
        .reward-screen {
            text-align: center;
            padding: 40px;
        }
        
        .reward-screen h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5em;
            color: var(--gold);
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .badges-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .badge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 4px solid #ddd;
            opacity: 0.5;
            transition: all 0.5s;
        }
        
        .badge.earned {
            opacity: 1;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
            animation: badgePop 0.6s ease;
        }
        
        @keyframes badgePop {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .game-header h1 { font-size: 2em; }
            .islands-map { grid-template-columns: 1fr; }
            .avatar-selection { grid-template-columns: repeat(2, 1fr); }
            .memory-grid { grid-template-columns: repeat(3, 1fr); }
        }
        
        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--gold);
            position: absolute;
            animation: confetti-fall 3s linear forwards;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Utility */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        
        /* Progress Stars */
        .stars {
            color: var(--gold);
            font-size: 1.5em;
            letter-spacing: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="game-header">
            <h1>üß† Brain Explorer Academy</h1>
            <p class="subtitle">Train your brain, earn your powers!</p>
        </div>

        <!-- Screen 1: Character Creation -->
        <div id="screen-create" class="screen active">
            <h2 class="text-center" style="color: var(--dark); margin-bottom: 20px;">Create Your Explorer</h2>
            
            <div class="avatar-selection">
                <div class="avatar-option" data-avatar="ü¶Å">ü¶Å</div>
                <div class="avatar-option" data-avatar="üöÄ">üöÄ</div>
                <div class="avatar-option" data-avatar="üåü">üåü</div>
                <div class="avatar-option" data-avatar="ü¶∏">ü¶∏</div>
                <div class="avatar-option" data-avatar="ü¶Ñ">ü¶Ñ</div>
                <div class="avatar-option" data-avatar="ü§ñ">ü§ñ</div>
                <div class="avatar-option" data-avatar="üåà">üåà</div>
                <div class="avatar-option" data-avatar="‚ö°">‚ö°</div>
            </div>
            
            <input type="text" id="explorer-name" class="name-input" placeholder="Enter your explorer name..." maxlength="20">
            
            <div class="text-center">
                <button class="btn" onclick="createExplorer()">Start Adventure! üöÄ</button>
            </div>
        </div>

        <!-- Screen 2: Dashboard -->
        <div id="screen-dashboard" class="screen">
            <div class="explorer-card">
                <div class="explorer-avatar" id="dash-avatar">ü¶Å</div>
                <div class="explorer-info">
                    <h2 id="dash-name">Explorer</h2>
                    <span class="level-badge" id="dash-level">Level 1 Trainee</span>
                    <div class="stats">
                        <div class="stat">
                            ‚ö° Focus: <span id="stat-focus">0</span>/10
                            <div class="stat-bar"><div class="stat-fill" id="bar-focus" style="width: 0%; background: var(--focus-blue);"></div></div>
                        </div>
                        <div class="stat">
                            üå± Memory: <span id="stat-memory">0</span>/10
                            <div class="stat-bar"><div class="stat-fill" id="bar-memory" style="width: 0%; background: var(--memory-green);"></div></div>
                        </div>
                        <div class="stat">
                            üí™ Challenge: <span id="stat-challenge">0</span>/10
                            <div class="stat-bar"><div class="stat-fill" id="bar-challenge" style="width: 0%; background: var(--challenge-orange);"></div></div>
                        </div>
                        <div class="stat">
                            üó∫Ô∏è Plan: <span id="stat-plan">0</span>/10
                            <div class="stat-bar"><div class="stat-fill" id="bar-plan" style="width: 0%; background: var(--plan-purple);"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h3 style="text-align: center; color: var(--dark); margin-bottom: 15px;">Choose Your Training Island:</h3>
            
            <div class="islands-map">
                <div class="island focus-island" onclick="startMission('focus')">
                    <div class="island-icon">üî¶</div>
                    <h3>Focus Falls</h3>
                    <p>Train your attention power!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-focus" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-focus">0</span>/3 Missions</p>
                </div>
                
                <div class="island memory-island" onclick="startMission('memory')">
                    <div class="island-icon">üå±</div>
                    <h3>Memory Meadows</h3>
                    <p>Grow your memory garden!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-memory" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-memory">0</span>/3 Missions</p>
                </div>
                
                <div class="island challenge-island" onclick="startMission('challenge')">
                    <div class="island-icon">üßó</div>
                    <h3>Challenge Canyon</h3>
                    <p>Climb the learning pit!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-challenge" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-challenge">0</span>/3 Missions</p>
                </div>
                
                <div class="island plan-island" onclick="startMission('plan')">
                    <div class="island-icon">üó∫Ô∏è</div>
                    <h3>Plan Peak</h3>
                    <p>Map your adventures!</p>
                    <div class="island-progress">
                        <div class="island-progress-bar" id="prog-plan" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.9em; margin-top: 5px;"><span id="count-plan">0</span>/3 Missions</p>
                </div>
            </div>
            
            <div class="text-center mt-20">
                <div id="total-crystals" style="font-size: 1.2em; margin-bottom: 15px;">
                    Total Power Crystals: <span class="crystal">üíé</span> <span id="crystal-count">0</span>
                </div>
                <button class="btn btn-purple" onclick="viewBadges()">View My Badges üèÜ</button>
            </div>
        </div>

        <!-- Screen 3: Mission -->
        <div id="screen-mission" class="screen">
            <div class="mission-container">
                <div id="mission-content">
                    <!-- Dynamic mission content loads here -->
                </div>
            </div>
        </div>

        <!-- Screen 4: Reward -->
        <div id="screen-reward" class="screen">
            <div class="reward-screen">
                <h2>Mission Complete! üéâ</h2>
                <div id="reward-message"></div>
                <div class="badges-container" id="badges-display">
                    <div class="badge" id="badge-focus" title="Focus Master">üî¶</div>
                    <div class="badge" id="badge-memory" title="Memory Gardener">üå±</div>
                    <div class="badge" id="badge-challenge" title="Puzzle Solver">üßó</div>
                    <div class="badge" id="badge-plan" title="Map Maker">üó∫Ô∏è</div>
                    <div class="badge" id="badge-master" title="Brain Master">üß†</div>
                </div>
                <div id="crystals-earned" class="mt-20" style="font-size: 1.5em;"></div>
                <button class="btn mt-20" onclick="returnToDashboard()">Back to Academy üè†</button>
            </div>
        </div>

        <!-- Screen 5: Badge Collection -->
        <div id="screen-badges" class="screen">
            <h2 class="text-center" style="color: var(--dark); margin-bottom: 30px;">Your Badge Collection</h2>
            <div class="badges-container" id="full-badge-collection" style="flex-direction: column; align-items: center;">
                <!-- Populated by JS -->
            </div>
            <div class="text-center mt-20">
                <button class="btn" onclick="returnToDashboard()">Back to Academy üè†</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            name: '',
            avatar: 'ü¶Å',
            level: 1,
            title: 'Trainee',
            stats: {
                focus: 0,
                memory: 0,
                challenge: 0,
                plan: 0
            },
            missionsCompleted: {
                focus: 0,
                memory: 0,
                challenge: 0,
                plan: 0
            },
            crystals: 0,
            badges: [],
            currentMission: null
        };

        // Mission Data
        const missions = {
            focus: [
                {
                    title: "The Laser Bridge",
                    desc: "Keep your spotlight steady while crossing the bridge!",
                    task: "Click the stars to collect them. Don't get distracted by the floating shapes!",
                    type: "spotlight",
                    time: 30,
                    reflection: "What happened when you got distracted? How did you bring your attention back?"
                },
                {
                    title: "Sound Hunter",
                    desc: "Train your ears to focus on important sounds.",
                    task: "Watch the pattern of sounds, then repeat it by clicking the buttons in order.",
                    type: "pattern",
                    time: 45,
                    reflection: "Did you say the pattern quietly in your head to remember it?"
                },
                {
                    title: "Focus Fuel",
                    desc: "Even explorers need breaks to recharge!",
                    task: "Do 10 jumping jacks, then come back and count backwards from 20 as fast as you can.",
                    type: "physical",
                    time: 60,
                    reflection: "How did your body feel after moving? Was it easier to focus?"
                }
            ],
            memory: [
                {
                    title: "Seed Planting",
                    desc: "Plant memories in your garden so they grow strong!",
                    task: "Match the pairs. When you find a match, draw it in your memory garden (imagine it)!",
                    type: "matching",
                    time: 60,
                    reflection: "Did making a picture in your head help you remember where cards were?"
                },
                {
                    title: "Teach the Stuffy",
                    desc: "Teaching others helps your own brain learn better!",
                    task: "Memorize this joke, then tell it to your favorite toy or person: Why did the scarecrow win an award? Because he was outstanding in his field!",
                    type: "teach",
                    time: 45,
                    reflection: "How did it feel to teach someone else? Did you understand the joke better?"
                },
                {
                    title: "Memory Watering",
                    desc: "Good memories need to be visited again and again!",
                    task: "Look at these 5 items for 10 seconds. Wait 10 seconds. Then write down all you remember.",
                    type: "recall",
                    time: 30,
                    reflection: "Which items were easiest to remember? Why do you think that is?"
                }
            ],
            challenge: [
                {
                    title: "The Learning Pit",
                    desc: "Getting stuck is just your brain growing stronger!",
                    task: "Solve this puzzle: Arrange numbers 1-4 so each row and column has no repeats. (Sudoku style)",
                    type: "puzzle",
                    time: 90,
                    reflection: "What did you try when you got stuck? How did it feel to keep trying?"
                },
                {
                    title: "Yet Tower",
                    desc: "Add the magic word 'YET' to everything!",
                    task: "Build a tower with blocks (or draw one). If it falls, say 'I haven't built it YET!' and try a different way.",
                    type: "tower",
                    time: 60,
                    reflection: "How did saying 'yet' change how you felt about the mistake?"
                },
                {
                    title: "Mistake Museum",
                    desc: "Our best learning comes from oops moments!",
                    task: "Think of a recent mistake you made. Draw it or describe it, then write what you learned from it.",
                    type: "reflect",
                    time: 45,
                    reflection: "Was it hard to think about a mistake? What did you learn that you won't forget?"
                }
            ],
            plan: [
                {
                    title: "Treasure Hunt Map",
                    desc: "Good explorers always make a plan before starting!",
                    task: "You need to: 1) Find the key 2) Open the chest 3) Get the gold. Drag the steps into the right order!",
                    type: "sequence",
                    time: 45,
                    reflection: "What would happen if you tried to open the chest before finding the key?"
                },
                {
                    title: "First/Then Train",
                    desc: "Doing things in order helps us succeed!",
                    task: "Sort these morning routine items: Eat breakfast, Wake up, Brush teeth, Get dressed. What's first? Then what?",
                    type: "sort",
                    time: 40,
                    reflection: "Why is it important to wake up before eating breakfast? What happens if we skip steps?"
                },
                {
                    title: "Plan B",
                    desc: "Sometimes plans change and we need to adapt!",
                    task: "You planned to play outside but it's raining! Drag 3 indoor activities you'd do instead.",
                    type: "adapt",
                    time: 35,
                    reflection: "How did it feel when the plan changed? Was it easy to think of new ideas?"
                }
            ]
        };

        // Initialize
        document.querySelectorAll('.avatar-option').forEach(avatar => {
            avatar.addEventListener('click', function() {
                document.querySelectorAll('.avatar-option').forEach(a => a.classList.remove('selected'));
                this.classList.add('selected');
                gameState.avatar = this.dataset.avatar;
            });
        });

        function createExplorer() {
            const nameInput = document.getElementById('explorer-name');
            if (!nameInput.value.trim()) {
                alert('Please enter your explorer name!');
                return;
            }
            gameState.name = nameInput.value.trim();
            showScreen('screen-dashboard');
            updateDashboard();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function updateDashboard() {
            document.getElementById('dash-avatar').textContent = gameState.avatar;
            document.getElementById('dash-name').textContent = gameState.name;
            document.getElementById('dash-level').textContent = `Level ${gameState.level} ${gameState.title}`;
            
            // Update stats
            for (let stat in gameState.stats) {
                document.getElementById(`stat-${stat}`).textContent = gameState.stats[stat];
                document.getElementById(`bar-${stat}`).style.width = (gameState.stats[stat] * 10) + '%';
                document.getElementById(`count-${stat}`).textContent = gameState.missionsCompleted[stat];
                document.getElementById(`prog-${stat}`).style.width = (gameState.missionsCompleted[stat] / 3 * 100) + '%';
            }
            
            document.getElementById('crystal-count').textContent = gameState.crystals;
            
            // Check level up
            checkLevelUp();
        }

        function checkLevelUp() {
            const totalMissions = Object.values(gameState.missionsCompleted).reduce((a, b) => a + b, 0);
            if (totalMissions >= 12 && gameState.level < 3) {
                gameState.level = 3;
                gameState.title = 'Master';
            } else if (totalMissions >= 6 && gameState.level < 2) {
                gameState.level = 2;
                gameState.title = 'Ranger';
            }
        }

        function startMission(type) {
            const missionIndex = gameState.missionsCompleted[type];
            if (missionIndex >= missions[type].length) {
                alert('You have completed all missions on this island! Try another one!');
                return;
            }
            
            gameState.currentMission = { type, index: missionIndex };
            const mission = missions[type][missionIndex];
            
            let html = `
                <div class="mission-card" style="border-color: var(--${type === 'focus' ? 'focus-blue' : type === 'memory' ? 'memory-green' : type === 'challenge' ? 'challenge-orange' : 'plan-purple'})">
                    <div class="mission-title">${mission.title}</div>
                    <div class="mission-desc">${mission.desc}</div>
                    <div class="timer" id="mission-timer">‚è±Ô∏è ${mission.time}s</div>
                    <div class="mission-task">
                        <strong>Your Mission:</strong> ${mission.task}
                    </div>
                </div>
                <div class="game-area" id="game-play-area">
                    ${getGameHTML(type, mission.type)}
                </div>
            `;
            
            document.getElementById('mission-content').innerHTML = html;
            showScreen('screen-mission');
            
            // Start game logic
            setTimeout(() => initGame(type, mission.type), 100);
        }

        function getGameHTML(type, gameType) {
            switch(gameType) {
                case 'spotlight':
                    return '<div class="spotlight-area" id="spotlight-game"></div><p>Click 10 stars to win! Avoid distractions!</p>';
                case 'matching':
                    return '<div class="memory-grid" id="memory-game"></div><p>Find all matching pairs!</p>';
                case 'sequence':
                case 'sort':
                    return '<ul class="task-list" id="sortable-list"></ul><button class="btn" onclick="checkOrder()">Check Order ‚úì</button>';
                case 'puzzle':
                    return '<div id="puzzle-game" style="font-size: 1.2em;"><p>Click cells to cycle through numbers 1-4. No repeats in rows or columns!</p><div id="sudoku-grid"></div></div>';
                case 'pattern':
                    return '<div id="pattern-game"><div id="pattern-display" style="font-size: 2em; margin: 20px;"></div><div id="pattern-buttons" style="margin: 20px;"></div></div>';
                default:
                    return '<div style="padding: 40px; text-align: center;"><p>Complete this mission in your notebook or with a grown-up!</p><button class="btn btn-green" onclick="completeMission()">I Did It! ‚úì</button></div>';
            }
        }

        function initGame(type, gameType) {
            if (gameType === 'spotlight') initSpotlight();
            if (gameType === 'matching') initMemory();
            if (gameType === 'sequence' || gameType === 'sort') initSortable(type);
            if (gameType === 'puzzle') initPuzzle();
            if (gameType === 'pattern') initPattern();
        }

        // Spotlight Game
        let starsCollected = 0;
        let spotlightInterval;
        
        function initSpotlight() {
            starsCollected = 0;
            const area = document.getElementById('spotlight-game');
            area.innerHTML = '';
            
            function spawnStar() {
                if (starsCollected >= 10) {
                    completeMission();
                    return;
                }
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = '‚≠ê';
                star.style.left = Math.random() * 80 + 10 + '%';
                star.style.top = Math.random() * 80 + 10 + '%';
                star.onclick = () => {
                    starsCollected++;
                    star.remove();
                    spawnDistraction();
                    setTimeout(spawnStar, 500);
                };
                area.appendChild(star);
                
                // Remove after 2 seconds if not clicked
                setTimeout(() => star.remove(), 2000);
            }
            
            function spawnDistraction() {
                const distractions = ['ü¶ã', 'üéà', 'üå∏', 'üí´'];
                const dist = document.createElement('div');
                dist.className = 'distraction';
                dist.textContent = distractions[Math.floor(Math.random() * distractions.length)];
                dist.style.left = Math.random() * 80 + 10 + '%';
                dist.style.top = Math.random() * 80 + 10 + '%';
                area.appendChild(dist);
                setTimeout(() => dist.remove(), 3000);
            }
            
            spawnStar();
        }

        // Memory Game
        let memoryMatches = 0;
        let flippedCards = [];
        let canFlip = true;
        
        function initMemory() {
            memoryMatches = 0;
            const grid = document.getElementById('memory-game');
            const emojis = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä'];
            
            // Shuffle
            for (let i = emojis.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [emojis[i], emojis[j]] = [emojis[j], emojis[i]];
            }
            
            grid.innerHTML = '';
            emojis.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.emoji = emoji;
                card.dataset.index = index;
                card.textContent = '?';
                card.onclick = () => flipCard(card, emoji);
                grid.appendChild(card);
            });
        }

        function flipCard(card, emoji) {
            if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) return;
            
            card.textContent = emoji;
            card.classList.add('flipped');
            flippedCards.push({card, emoji});
            
            if (flippedCards.length === 2) {
                canFlip = false;
                setTimeout(checkMatch, 1000);
            }
        }

        function checkMatch() {
            const [first, second] = flippedCards;
            if (first.emoji === second.emoji) {
                first.card.classList.add('matched');
                second.card.classList.add('matched');
                memoryMatches++;
                if (memoryMatches === 6) {
                    setTimeout(completeMission, 500);
                }
            } else {
                first.card.textContent = '?';
                second.card.textContent = '?';
                first.card.classList.remove('flipped');
                second.card.classList.remove('flipped');
            }
            flippedCards = [];
            canFlip = true;
        }

        // Sortable List Game
        let currentOrder = [];
        
        function initSortable(type) {
            const list = document.getElementById('sortable-list');
            let items = [];
            
            if (type === 'sequence') {
                items = [
                    {text: 'Get the gold', correct: 3},
                    {text: 'Find the key', correct: 1},
                    {text: 'Open the chest', correct: 2}
                ];
            } else if (type === 'sort') {
                items = [
                    {text: 'Wake up', correct: 1},
                    {text: 'Eat breakfast', correct: 2},
                    {text: 'Brush teeth', correct: 3},
                    {text: 'Get dressed', correct: 4}
                ];
            }
            
            // Shuffle
            currentOrder = items.map((item, idx) => ({...item, current: idx}));
            currentOrder.sort(() => Math.random() - 0.5);
            
            renderSortable();
        }

        function renderSortable() {
            const list = document.getElementById('sortable-list');
            list.innerHTML = '';
            currentOrder.forEach((item, idx) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.innerHTML = `
                    <span class="task-number">${idx + 1}</span>
                    <span>${item.text}</span>
                    <button onclick="moveUp(${idx})" style="margin-left: auto; background: none; border: none; font-size: 1.2em; cursor: pointer;">‚¨ÜÔ∏è</button>
                    <button onclick="moveDown(${idx})" style="background: none; border: none; font-size: 1.2em; cursor: pointer;">‚¨áÔ∏è</button>
                `;
                list.appendChild(li);
            });
        }

        function moveUp(index) {
            if (index > 0) {
                [currentOrder[index], currentOrder[index-1]] = [currentOrder[index-1], currentOrder[index]];
                renderSortable();
            }
        }

        function moveDown(index) {
            if (index < currentOrder.length - 1) {
                [currentOrder[index], currentOrder[index+1]] = [currentOrder[index+1], currentOrder[index]];
                renderSortable();
            }
        }

        function checkOrder() {
            const isCorrect = currentOrder.every((item, idx) => item.correct === idx + 1);
            if (isCorrect) {
                alert('Perfect order! Great planning! üéâ');
                completeMission();
            } else {
                alert('Not quite right. Think about what must come first!');
            }
        }

        // Puzzle Game (Simple 2x2 Sudoku)
        let puzzleGrid = [[0,0],[0,0]];
        
        function initPuzzle() {
            puzzleGrid = [[1,2],[3,4]];
            // Shuffle to create puzzle
            for (let i = 0; i < 4; i++) {
                const row = Math.floor(i / 2);
                const col = i % 2;
                puzzleGrid[row][col] = Math.floor(Math.random() * 4) + 1;
            }
            renderPuzzle();
        }

        function renderPuzzle() {
            const container = document.getElementById('sudoku-grid');
            container.innerHTML = '';
            container.style.display = 'grid';
            container.style.gridTemplateColumns = 'repeat(2, 60px)';
            container.style.gap = '10px';
            container.style.justifyContent = 'center';
            container.style.margin = '20px';
            
            for (let row = 0; row < 2; row++) {
                for (let col = 0; col < 2; col++) {
                    const cell = document.createElement('div');
                    cell.style.width = '60px';
                    cell.style.height = '60px';
                    cell.style.border = '3px solid var(--challenge-orange)';
                    cell.style.borderRadius = '10px';
                    cell.style.display = 'flex';
                    cell.style.alignItems = 'center';
                    cell.style.justifyContent = 'center';
                    cell.style.fontSize = '1.5em';
                    cell.style.cursor = 'pointer';
                    cell.style.background = 'white';
                    cell.textContent = puzzleGrid[row][col];
                    cell.onclick = () => {
                        puzzleGrid[row][col] = (puzzleGrid[row][col] % 4) + 1;
                        renderPuzzle();
                        checkPuzzle();
                    };
                    container.appendChild(cell);
                }
            }
        }

        function checkPuzzle() {
            // Check rows and columns for 1-4 (simplified for 2x2)
            const valid = puzzleGrid[0][0] !== puzzleGrid[0][1] && 
                         puzzleGrid[1][0] !== puzzleGrid[1][1] &&
                         puzzleGrid[0][0] !== puzzleGrid[1][0] &&
                         puzzleGrid[0][1] !== puzzleGrid[1][1];
            if (valid) {
                setTimeout(() => {
                    alert('You solved it! Great persistence! üéâ');
                    completeMission();
                }, 300);
            }
        }

        // Pattern Game
        let patternSequence = [];
        let playerPattern = [];
        
        function initPattern() {
            patternSequence = [];
            playerPattern = [];
            const buttons = ['üî¥', 'üîµ', 'üü¢', 'üü°'];
            const display = document.getElementById('pattern-display');
            const btnContainer = document.getElementById('pattern-buttons');
            
            // Generate pattern
            for (let i = 0; i < 4; i++) {
                patternSequence.push(Math.floor(Math.random() * 4));
            }
            
            // Show pattern
            let i = 0;
            display.textContent = 'Watch...';
            const interval = setInterval(() => {
                if (i >= patternSequence.length) {
                    clearInterval(interval);
                    display.textContent = 'Your turn!';
                    showPatternButtons();
                    return;
                }
                display.textContent = buttons[patternSequence[i]];
                i++;
            }, 800);
            
            function showPatternButtons() {
                btnContainer.innerHTML = '';
                buttons.forEach((btn, idx) => {
                    const button = document.createElement('button');
                    button.textContent = btn;
                    button.style.fontSize = '2em';
                    button.style.margin = '10px';
                    button.style.padding = '15px';
                    button.style.border = 'none';
                    button.style.borderRadius = '10px';
                    button.style.cursor = 'pointer';
                    button.onclick = () => {
                        playerPattern.push(idx);
                        if (playerPattern[playerPattern.length - 1] !== patternSequence[playerPattern.length - 1]) {
                            alert('Oops! Listen again...');
                            playerPattern = [];
                            initPattern();
                            return;
                        }
                        if (playerPattern.length === patternSequence.length) {
                            alert('Perfect focus! You remembered the pattern! üéâ');
                            completeMission();
                        }
                    };
                    btnContainer.appendChild(button);
                });
            }
        }

        // Complete Mission
        function completeMission() {
            const { type, index } = gameState.currentMission;
            const mission = missions[type][index];
            
            // Show reflection
            const html = `
                <div class="reflection">
                    <h3>ü§î Brain Reflection Time</h3>
                    <p style="margin-bottom: 15px;"><strong>${mission.reflection}</strong></p>
                    <div class="reflection-options">
                        <button class="reflection-btn" onclick="finishReflection('A')">I noticed my attention wandering, then I brought it back!</button>
                        <button class="reflection-btn" onclick="finishReflection('B')">I felt frustrated but kept trying!</button>
                        <button class="reflection-btn" onclick="finishReflection('C')">I made a picture in my head to help me!</button>
                        <button class="reflection-btn" onclick="finishReflection('D')">I broke it into smaller steps!</button>
                    </div>
                </div>
            `;
            document.getElementById('mission-content').innerHTML = html;
        }

        function finishReflection(answer) {
            // Update stats
            const { type } = gameState.currentMission;
            gameState.missionsCompleted[type]++;
            gameState.stats[type] = Math.min(10, gameState.stats[type] + 2);
            gameState.crystals += 2;
            
            // Check for badge
            if (gameState.missionsCompleted[type] === 3 && !gameState.badges.includes(type)) {
                gameState.badges.push(type);
            }
            
            // Check for master badge
            if (gameState.badges.length === 4 && !gameState.badges.includes('master')) {
                gameState.badges.push('master');
            }
            
            showReward();
        }

        function showReward() {
            const { type } = gameState.currentMission;
            const messages = {
                focus: "Your Focus Power leveled up! üî¶‚ú®",
                memory: "Your Memory Garden grew! üå±‚ú®",
                challenge: "You conquered the Learning Pit! üßó‚ú®",
                plan: "You drew a perfect Treasure Map! üó∫Ô∏è‚ú®"
            };
            
            document.getElementById('reward-message').innerHTML = `
                <p style="font-size: 1.3em; color: #555; margin-bottom: 20px;">${messages[type]}</p>
                <p>You earned 2 Power Crystals! üíéüíé</p>
            `;
            
            // Update badges display
            document.querySelectorAll('.badge').forEach(badge => {
                badge.classList.remove('earned');
            });
            
            gameState.badges.forEach(badge => {
                const el = document.getElementById(`badge-${badge}`);
                if (el) el.classList.add('earned');
            });
            
            // Create confetti
            for (let i = 0; i < 20; i++) {
                setTimeout(() => createConfetti(), i * 100);
            }
            
            showScreen('screen-reward');
        }

        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.background = ['#FFD93D', '#4ECDC4', '#F38181', '#AA96DA'][Math.floor(Math.random() * 4)];
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }

        function returnToDashboard() {
            updateDashboard();
            showScreen('screen-dashboard');
        }

        function viewBadges() {
            const container = document.getElementById('full-badge-collection');
            const badgeData = [
                {id: 'focus', icon: 'üî¶', name: 'Focus Master', desc: 'Complete all Focus Falls missions'},
                {id: 'memory', icon: 'üå±', name: 'Memory Gardener', desc: 'Complete all Memory Meadows missions'},
                {id: 'challenge', icon: 'üßó', name: 'Puzzle Solver', desc: 'Complete all Challenge Canyon missions'},
                {id: 'plan', icon: 'üó∫Ô∏è', name: 'Map Maker', desc: 'Complete all Plan Peak missions'},
                {id: 'master', icon: 'üß†', name: 'Brain Master', desc: 'Earn all other badges'}
            ];
            
            container.innerHTML = badgeData.map(badge => `
                <div style="display: flex; align-items: center; gap: 20px; background: ${gameState.badges.includes(badge.id) ? 'linear-gradient(135deg, #fff9e6, #fff)' : '#f5f5f5'}; 
                            padding: 20px; border-radius: 15px; width: 100%; max-width: 400px;
                            border: 3px solid ${gameState.badges.includes(badge.id) ? 'var(--gold)' : '#ddd'};">
                    <div style="font-size: 3em; opacity: ${gameState.badges.includes(badge.id) ? 1 : 0.3};">${badge.icon}</div>
                    <div style="text-align: left;">
                        <div style="font-family: 'Fredoka One', cursive; font-size: 1.3em; color: ${gameState.badges.includes(badge.id) ? 'var(--dark)' : '#999'};">
                            ${badge.name} ${gameState.badges.includes(badge.id) ? '‚úì' : 'üîí'}
                        </div>
                        <div style="color: #666; font-size: 0.9em;">${badge.desc}</div>
                    </div>
                </div>
            `).join('');
            
            showScreen('screen-badges');
        }
    </script>
</body>
</html>
